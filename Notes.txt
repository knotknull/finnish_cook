
##  Download and install chefdk
##

curl  https://packages.chef.io/files/stable/chefdk/2.4.17/el/7/chefdk-2.4.17-1.el7.x86_64.rpm  -o chefdk-2.4.17-1.el7.x86_64.rpm -#
sudo yum install chefdk-2.4.17-1.el7.x86_64.rpm


##  To install Guest Additions automatically in the Vagrant VM
##
vagrant plugin install vagrant-vbguest


##  When installing chef, it installs into /opt/chefdk but creates soft links from /usr/bin to chefdk i.e.:
##  NOTE:  need to update .bashrc to link git and ruby versions installed in /opt/chefdk/embedded
##
ls -l /usr/bin/chef
lrwxrwxrwx. 1 root root 20 Feb 20 14:18 /usr/bin/chef -> /opt/chefdk/bin/chef

## Enter the below to .bashrc to get environment to point to git and ruby installed with chef.
##
eval "$(chef shell-init bash)"

## Jargon Alert !!
##

   - Programs in Chef called recipe.
   - recipe:  file that contains chef code (*.rb = ruby)
   - Chef is Ruby Domain Specific Language
   - Resource (i.e. file below) building blocks for chef code
      - defines actions for chef to perform
      - bracketed by do / end statement pair
      - Generic layout of resource:
            <resource_type> '<name>' do
              <attribute statement>
            end
   - Attribute is a parameter to a resource


## Chef recipe exmple
##

hello.rb:
---------

file 'hello.txt' do
  content 'Welcome to Finnish Cook'
end

## NOTE: file name can be single or double quotes.  Content is an attribute
## or parameter that is passed to the file resource.
## https://docs.chef.io/resource_file.html
##

## To run chef code, call chef-apply, it runs single files of chef .rb code.
##
chef-apply hello.rb

## Creates a file called hello.txt with the content described in the chef file
##
[vagrant@chefbox share]$ ls -ltr
total 12
-rw-r--r--. 1 vagrant vagrant 21 Feb 20 22:55 itchy
-rw-r--r--. 1 vagrant vagrant 60 Feb 20 23:22 hello.rb
-rw-r--r--. 1 vagrant vagrant 23 Feb 20 23:24 hello.txt
[vagrant@chefbox share]$ cat hello.txt
Welcome to Finnish Cook


## Cookstyle: Chef took to check syntax (lint checker)
## eg.     cookstyle hello.rb

## Change ruby linter to cookstyle
##
1. Start Atom
2. Atom > Preferences > Install
3. In Search packages enter linter-rubocop
4. After install go to settings
5. In Settings > Command, enter:
/opt/chefdk/bin/cookstyle
6. tab out of field
7. test against a .rb file

## Automate verification w/ inspec
## inspec: Inspect Infrastructure
##
inspec runs tests to validate the infrastructure that is created
by you chef reciple that you create:

1. create hello_test.rb to hold testing code (_test is a convention)
NOTE: This test detects the existence of hello.txt as well as its' contents

describe file('hello.txt') do
  it { should be_file }
  its('content') { should match('Welcome to Finnish Cook') }
end

NOTE: brace {} are short cut for do / end


2. At cli run inspec w/ inspec test file
> inspec exec hello_test.rb

Profile: tests from hello_test.rb (tests from hello_test.rb)
Version: (not specified)
Target:  local://


  File hello.txt
     ✔  should be file
     ✔  content should match "Welcome to Finnish Cook"

Test Summary: 2 successful, 0 failures, 0 skipped


Anatomy of a test file
- Verification building block
describe <resource_type> '<name>' do
  <checks>
end

INSPEC EXMAPLES at: https://docs.chef.io/inspec_reference.html
NOTE: resources mentioned in chef recipe will most likely have an 'audit'
inspec resource by the same name i.e. file.





#
